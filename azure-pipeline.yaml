pool:
  vmImage: ubuntu-latest

container: 
  image: golang:1.18.1-buster
  endpoint: DockerHub - Han_Yang_Kuo

variables:
  GOPATH: '$(Pipeline.Workspace)/go' # Go workspace path
  GOBIN:  '$(GOPATH)/bin' # Go binaries path
  # GOROOT: '/usr/local/go1.11' # Go installation path

steps:
  - checkout: self
    path: go/src
  - script: |
      export PATH=$(GOPATH)/bin:$PATH
      
      echo "** cd Pipeline.Workspace **"
      echo $(Pipeline.Workspace)
      
      echo "** cd defaultWorkingDirectory **"
      echo $(system.defaultWorkingDirectory)


      sudo go install mvdan.cc/garble@latest

      echo pwd = $(pwd)
      echo "** list recursive in defaultWorkingDirectory**"
      ls -R

      echo "** goto GOBIN **"
      cd $(GOBIN)
      pwd
      echo "** ls GOBIN **"
      ls

      # echo pwd = $(pwd)
      # echo PATH = $(PATH)
      # echo "** echo GOBIN **"
      # echo GOBIN = $(GOBIN)
      # echo "** echo GOPATH **"
      # echo GOPATH = $(GOPATH)
      # go mod tidy
      # go env -w GOOS=windows
      # go env -w GOARCH=amd64
      # go install mvdan.cc/garble@latest

      # garble build -o agent.exe com.young/botnet/agent
      
  - task: CopyFiles@2
    inputs:
      Contents: |
        *.exe
      TargetFolder: '$(Build.ArtifactStagingDirectory)'
  - task: PublishBuildArtifacts@1
    inputs:
      artifactName: agent
  

