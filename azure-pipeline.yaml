pool:
  vmImage: ubuntu-latest

container: 
  image: golang:1.18.1-buster
  endpoint: DockerHub - Han_Yang_Kuo

variables:
  GOBIN:  '$(GOPATH)/bin' # Go binaries path
  # GOROOT: '/usr/local/go1.11' # Go installation path
  GOPATH: '$(system.defaultWorkingDirectory)' # Go workspace path
  # modulePath: '$(GOPATH)/src/github.com/$(build.repository.name)' # Path to the module's code

steps:
  - checkout: self
    target: $(GOPATH)/src
  - script: |
      go mod tidy
      go env -w GOOS=windows
      go env -w GOARCH=amd64
      go install mvdan.cc/garble@latest
      
      echo PATH = $PATH
      echo "** echo /go/bin **"
      ls /go/bin

      garble build -o agent.exe com.young/botnet/agent
      
  - task: CopyFiles@2
    inputs:
      Contents: |
        *.exe
      TargetFolder: '$(Build.ArtifactStagingDirectory)'
  - task: PublishBuildArtifacts@1
    inputs:
      artifactName: agent
  

